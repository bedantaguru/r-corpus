<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stemming Words • corpus</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-4636081-3', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">corpus</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/corpus.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/chinese.html">Chinese text handling</a>
    </li>
    <li>
      <a href="../articles/gender.html">Finding gendered words</a>
    </li>
    <li>
      <a href="../articles/stemmer.html">Stemming Words</a>
    </li>
    <li>
      <a href="../articles/textdata.html">Text data in Corpus and other packages</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/patperry/r-corpus">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Stemming Words</h1>
            
          </div>

    
    
<div class="contents">
<div id="snowball-stemmer" class="section level2">
<h2 class="hasAnchor">
<a href="#snowball-stemmer" class="anchor"></a>Snowball stemmer</h2>
<p><em>Corpus</em> comes with built-in support for the algorithmic stemmers provided by the <a href="https://snowballstem.org/" title="Snowball Stemming Library">Snowball Stemming Library</a>, which supports the following languages: arabic (ar), danish (da), german (de), english (en), spanish (es), finnish (fi), french (fr), hungarian (hu), italian (it), dutch (nl), norwegian (no), portuguese (pt), romanian (ro), russian (ru), swedish (sv), tamil (ta), and turkish (tr). You can select one of these stemmers using either the full name of the language of the two-letter country code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> "love loving lovingly loved lover lovely love"</span>
<span class="kw"><a href="../reference/text_tokens.html">text_tokens</a></span>(text, <span class="dt">stemmer =</span> <span class="st">"en"</span>) <span class="co"># english stemmer</span></code></pre></div>
<pre><code>[[1]]
[1] "love"  "love"  "love"  "love"  "lover" "love"  "love" </code></pre>
<p>These stemmers are purely algorithmic; they mostly just strip off common suffixes.</p>
</div>
<div id="hunspell-stemmer" class="section level2">
<h2 class="hasAnchor">
<a href="#hunspell-stemmer" class="anchor"></a>Hunspell stemmer</h2>
<p>If you want more precise stemming behavior, you can provide a custom stemming function. The stemming function should, when given a term as an input, return the stem of the term as the output.</p>
<p>Here’s an example that uses the <code>hunspell</code> dictionary to do the stemming.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stem_hunspell &lt;-<span class="st"> </span><span class="cf">function</span>(term) {
    <span class="co"># look up the term in the dictionary</span>
    stems &lt;-<span class="st"> </span>hunspell<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hunspell/topics/hunspell">hunspell_stem</a></span>(term)[[<span class="dv">1</span>]]

    <span class="cf">if</span> (<span class="kw">length</span>(stems) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) { <span class="co"># if there are no stems, use the original term</span>
        stem &lt;-<span class="st"> </span>term
    } <span class="cf">else</span> { <span class="co"># if there are multiple stems, use the last one</span>
        stem &lt;-<span class="st"> </span>stems[[<span class="kw">length</span>(stems)]]
    }

    stem
}

<span class="kw"><a href="../reference/text_tokens.html">text_tokens</a></span>(text, <span class="dt">stemmer =</span> stem_hunspell)</code></pre></div>
<pre><code>[[1]]
[1] "love"     "love"     "lovingly" "love"     "love"     "love"     "love"    </code></pre>
</div>
<div id="dictionary-stemmer" class="section level2">
<h2 class="hasAnchor">
<a href="#dictionary-stemmer" class="anchor"></a>Dictionary stemmer</h2>
<p>One common way to build a stemmer is from a list of (term, stem) pairs. Many such lists are available at <a href="http://www.lexiconista.com/datasets/lemmatization/" title="Lexiconista Lemmatization Lists">lexoconista.com</a>. Here’s an example stemmer for English:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># download the list</span>
url &lt;-<span class="st"> "http://www.lexiconista.com/Datasets/lemmatization-en.zip"</span>
tmp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
<span class="kw">download.file</span>(url, tmp)

<span class="co"># extract the contents</span>
con &lt;-<span class="st"> </span><span class="kw">unz</span>(tmp, <span class="st">"lemmatization-en.txt"</span>, <span class="dt">encoding =</span> <span class="st">"UTF-8"</span>)
tab &lt;-<span class="st"> </span><span class="kw">read.delim</span>(con, <span class="dt">header=</span><span class="ot">FALSE</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="kw">names</span>(tab) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"stem"</span>, <span class="st">"term"</span>)</code></pre></div>
<p>The first column of this table contains the stem; the second column contains the raw term:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(tab)</code></pre></div>
<pre><code>        stem       term
1          1      first
2         10      tenth
3        100  hundredth
4       1000 thousandth
5    1000000  millionth
6 1000000000  billionth</code></pre>
<p>We can see that, for example, <code>"first"</code> stems to <code>"1"</code>.</p>
<p>Here a custom stemming function that uses the list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stem_list &lt;-<span class="st"> </span><span class="cf">function</span>(term) {
    i &lt;-<span class="st"> </span><span class="kw">match</span>(term, tab<span class="op">$</span>term)
    <span class="cf">if</span> (<span class="kw">is.na</span>(i)) {
        stem &lt;-<span class="st"> </span>term
    } <span class="cf">else</span> {
        stem &lt;-<span class="st"> </span>tab<span class="op">$</span>stem[[i]]
    }
    stem
}

<span class="kw"><a href="../reference/text_tokens.html">text_tokens</a></span>(text, <span class="dt">stemmer =</span> stem_list)</code></pre></div>
<pre><code>[[1]]
[1] "love"     "love"     "lovingly" "love"     "lover"    "lovely"   "love"    </code></pre>
<p>This pattern is so common that <em>corpus</em> provides a convenience function that will build a stemmer from the input term and stem lists:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stem_list2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/new_stemmer.html">new_stemmer</a></span>(tab<span class="op">$</span>term, tab<span class="op">$</span>stem)
<span class="kw"><a href="../reference/text_tokens.html">text_tokens</a></span>(text, <span class="dt">stemmer =</span> stem_list2)</code></pre></div>
<pre><code>[[1]]
[1] "love"     "love"     "lovingly" "love"     "lover"    "lovely"   "love"    </code></pre>
</div>
<div id="application-emotion-word-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#application-emotion-word-usage" class="anchor"></a>Application: Emotion word usage</h2>
<p>Here’s how to use a custom stemmer to get counts of emotion word usage. We will use the text of <em>The Wizard of Oz</em> (Project Gutenberg Work #55) to demonstrate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gutenberg_corpus.html">gutenberg_corpus</a></span>(<span class="dv">55</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="../reference/text_filter.html">text_filter</a></span>(data)<span class="op">$</span>stemmer &lt;-
<span class="st">    </span><span class="kw">with</span>(affect_wordnet,
        <span class="kw"><a href="../reference/new_stemmer.html">new_stemmer</a></span>(term, <span class="kw">interaction</span>(category, emotion),
                    <span class="dt">default =</span> <span class="ot">NA</span>, <span class="dt">duplicates =</span> <span class="st">"omit"</span>))</code></pre></div>
<p>This stemmer replaces terms by the emotional affect, as listed in the <code>affect_wordnet</code> lexicon. Setting <code>default = NA</code> specifies that terms that are not in the lexicon get dropped. We also specify <code>duplicates = "omit"</code> so that words listed in multiple categories get replaced with the default (i.e., they get dropped).</p>
<p>Here are the (stemmed) term statistics:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw"><a href="../reference/term_stats.html">term_stats</a></span>(data), <span class="op">-</span><span class="dv">1</span>)</code></pre></div>
<pre><code>   term                  count support
1  Sadness.Negative        207       1
2  Enthusiasm.Positive     146       1
3  Dislike.Negative        109       1
4  Joy.Positive             97       1
5  Liking.Positive          94       1
6  Love.Positive            81       1
7  Affection.Positive       77       1
8  Fear.Negative            75       1
9  Agitation.Ambiguous      38       1
10 Anxiety.Negative         24       1
11 Calmness.Positive        24       1
12 Gravity.Ambiguous        21       1
13 Shame.Negative           20       1
14 Surprise.Ambiguous       12       1
15 Gratitude.Positive       10       1
16 Expectation.Ambiguous     9       1
17 Pride.Positive            7       1
18 Compassion.Negative       5       1
19 Despair.Negative          3       1
20 Daze.Negative             2       1
21 Fear.Positive             1       1
22 Fearlessness.Positive     1       1</code></pre>
<p>We can also get a sample of the instances of the stemmed terms:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/text_locate.html">text_sample</a></span>(data, <span class="st">"Joy.Positive"</span>)</code></pre></div>
<pre><code>   text                before                  instance                   after                
1  1    … Scarecrow and the Tin Woodman were     glad      to be of\nuse to her.  As for the L…
2  1    …rs and\nfruit trees and sunshine to     cheer     them, and had they not felt so sorr…
3  1    …te a little of\neverything, and was     glad      to get a good supper again.\n\nThe …
4  1    …Dorothy and her friends spent a few     happy    \ndays at the Yellow Castle, where t…
5  1    …ever thought of that!" said Dorothy   joyfully   .  "It's just the\nthing.  I'll go a…
6  1    …d the Tin Woodman, "you ought to be     glad     , for it\nproves you have a heart.  …
7  1    …of this beautiful City, I am\nquite   satisfied   with my lot."\n\n"I also," said the…
8  1    …y don't belong there.  We\nshall be     glad      to serve you in any way in our powe…
9  1    …der, "we were a free people, living    happily    in the\ngreat forest, flying from t…
10 1    …get my brains," added the Scarecrow   joyfully   .\n\n"And I shall get my courage," s…
11 1    …hing and singing, while a big table     near      by was\nloaded with delicious fruit…
12 1    … brains do not\nmake one happy, and   happiness   is the best thing in the world."\n… 
13 1    …know enough," replied the Scarecrow  cheerfully  .  "My head is\nstuffed with straw, …
14 1    …ut it, if you wish."\n\n"I shall be     glad      to hear it," she replied.\n\n"Once,…
15 1    …such little\nthings as flowers came     near      to killing me, and such small anima…
16 1    …apid flight of the Monkeys, but was     glad      the journey was over.\nThe strange …
17 1    …tle room in the world, with a soft\n comfortable  bed that had sheets of green silk a…
18 1    …ued the Scarecrow, "we might all be     happy     together."\n\n"But I don't want to …
19 1    …\nThus each of the little party was   satisfied   except Dorothy, who longed\nmore th…
20 1    …ught Dorothy some fruit from a tree     near      by, which she\nate for her dinner.… 
⋮  (97 rows total)</code></pre>
</div>
<div id="application-spell-corrected-tokens" class="section level2">
<h2 class="hasAnchor">
<a href="#application-spell-corrected-tokens" class="anchor"></a>Application: Spell-corrected tokens</h2>
<p>Suppose we want to analyze texts with spelling errors, using our best guess of the intended word rather than the literal spelling in the text. We can do this by using a stemmer that tries to correct spelling errors in the tokens:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stem_spellcorrect &lt;-<span class="st"> </span><span class="cf">function</span>(term) {
    <span class="co"># if the term is spelled correctly, leave it as-is</span>
    <span class="cf">if</span> (hunspell<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hunspell/topics/hunspell">hunspell_check</a></span>(term)) {
        <span class="kw">return</span>(term)
    }

    suggestions &lt;-<span class="st"> </span>hunspell<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hunspell/topics/hunspell">hunspell_suggest</a></span>(term)[[<span class="dv">1</span>]]

    <span class="co"># if hunspell found a suggestion, use the first one</span>
    <span class="cf">if</span> (<span class="kw">length</span>(suggestions) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
        suggestions[[<span class="dv">1</span>]]
    } <span class="cf">else</span> {
        <span class="co"># otherwise, use the original term</span>
        term
    }
}</code></pre></div>
<p>Here’s an example use of the stemmer:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> "spell checkers are not neccessairy for langauge ninja's"</span>
<span class="kw"><a href="../reference/text_tokens.html">text_tokens</a></span>(text, <span class="dt">stemmer =</span> stem_spellcorrect)</code></pre></div>
<pre><code>[[1]]
[1] "spell"     "checkers"  "are"       "not"       "necessary" "for"       "language" 
[8] "ninjas"   </code></pre>
</div>
<div id="efficiency-considerations" class="section level2">
<h2 class="hasAnchor">
<a href="#efficiency-considerations" class="anchor"></a>Efficiency considerations</h2>
<p>When you stem a text, the result gets cached, so you never have to stem the same type twice. If the input is a <code>corpus_text</code> object, these cached values are shared across multiple tokenizations.</p>
<p>Here’s a stemmer that prepends “bunny” to every word, keeping track of how many times it gets called:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nbunny &lt;-<span class="st"> </span><span class="dv">0</span>
stem_bunny &lt;-<span class="st"> </span><span class="cf">function</span>(term) {
    nbunny &lt;&lt;-<span class="st"> </span>nbunny <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
    <span class="kw">paste</span>(<span class="st">"bunny"</span>, term)
}</code></pre></div>
<p>We will set this as the stemmer for a corpus (a data frame with a “text” column of type <code>corpus_text</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corpus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/corpus_frame.html">as_corpus_frame</a></span>(federalist)
<span class="kw"><a href="../reference/text_filter.html">text_filter</a></span>(corpus)<span class="op">$</span>stemmer &lt;-<span class="st"> </span>stem_bunny</code></pre></div>
<p>Here’s how long it takes to tokenize the text once and compute the term statistics:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(stats &lt;-<span class="st"> </span><span class="kw"><a href="../reference/term_stats.html">term_stats</a></span>(corpus))</code></pre></div>
<pre><code>   user  system elapsed 
  0.103   0.003   0.107 </code></pre>
<p>Here’s how many times the stemmer got called:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(nbunny)</code></pre></div>
<pre><code>[1] 8766</code></pre>
<p>We will now set the bunny count to zero and run the same computation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nbunny &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="kw">system.time</span>(stats2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/term_stats.html">term_stats</a></span>(corpus))</code></pre></div>
<pre><code>   user  system elapsed 
  0.042   0.000   0.043 </code></pre>
<p>It took us half the time. How many additional calls to the stemmer were there?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(nbunny)</code></pre></div>
<pre><code>[1] 0</code></pre>
<p>No additional calls. We used the cached stems from the first call to <code>term_stats</code>. We can verify that the results were the same both times.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(stats, stats2)</code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>Just for fun, here are the results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stats</code></pre></div>
<pre><code>   term        count support
1  bunny_the   17743      85
2  bunny_,     13251      85
3  bunny_of    11798      85
4  bunny_to     7052      85
5  bunny_.      5400      85
6  bunny_and    5080      85
7  bunny_in     4439      85
8  bunny_a      3984      85
9  bunny_be     3832      85
10 bunny_that   2788      85
11 bunny_it     2544      85
12 bunny_is     2190      85
13 bunny_which  2061      85
14 bunny_by     1745      85
15 bunny_as     1720      85
16 bunny_;      1496      85
17 bunny_this   1409      85
18 bunny_would  1277      85
19 bunny_have   1258      85
20 bunny_will   1250      85
⋮  (8766 rows total)</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#snowball-stemmer">Snowball stemmer</a></li>
      <li><a href="#hunspell-stemmer">Hunspell stemmer</a></li>
      <li><a href="#dictionary-stemmer">Dictionary stemmer</a></li>
      <li><a href="#application-emotion-word-usage">Application: Emotion word usage</a></li>
      <li><a href="#application-spell-corrected-tokens">Application: Spell-corrected tokens</a></li>
      <li><a href="#efficiency-considerations">Efficiency considerations</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Patrick O. Perry.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
